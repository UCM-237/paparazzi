<!DOCTYPE module SYSTEM "module.dtd">

<!--https://github.com/iNavFlight/inav/blob/master/src/main/target/MATEKH743/target.h-->

<module name="board_matek_h743_car" dir="boards">
  <doc>
    <description>
      Autoload several onboard sensors and subsystems
      for the Matek h743 Wing board with proper configuration fixed for rovers.
      IMU ICM20602 (auto-detected from MPU6000 driver) (god bless)
      Baro (BMP280)
      OSD (desactivated for rovers)
      Normal back of the board is on the battery/ESC wires
      Normal up of the board is on MCU side.
    </description>
    <configure name="BOARD_MATEK_ROTATED" value="FALSE|TRUE" description="if TRUE, the board is not using is default orientation and axis can be redefined by hand"/>
  </doc>
  <dep>
    <depends>spi_master,baro_bmp280_i2c,current_sensor,imu_mpu6000</depends>
  </dep>

  <makefile target="!sim|nps|fbw">
    <!-- IMU CONFIGURATION -->
    <configure name="IMU_MPU_SPI_DEV" value="spi4" case="upper|lower"/> <!-- inav... -->
    <configure name="IMU_MPU_SPI_SLAVE_IDX" value="SPI_SLAVE6"/> <!-- PC13 (inav) -->
    <define name="IMU_MPU_GYRO_RANGE" value="MPU60X0_GYRO_RANGE_1000"/>
    <define name="IMU_MPU_ACCEL_RANGE" value="MPU60X0_ACCEL_RANGE_8G"/>
    <define name="IMU_MPU_CHAN_X" value="1" cond="ifeq (,$(findstring $(BOARD_MATEK_ROTATED),1 TRUE))"/>
    <define name="IMU_MPU_CHAN_Y" value="0" cond="ifeq (,$(findstring $(BOARD_MATEK_ROTATED),1 TRUE))"/>
    <define name="IMU_MPU_X_SIGN" value="-1" cond="ifeq (,$(findstring $(BOARD_MATEK_ROTATED),1 TRUE))"/>
    <!-- BAROMETER BMP280 CONFIGURATION (not the same but o well)-->
    <configure name="BMP280_I2C_DEV" value="i2c2"/>
    <!-- OSD CONFIGURATION -->
    <configure name="MAX7456_SPI_DEV" value="spi2"/> <!-- inav -->
    <configure name="MAX7456_SLAVE_IDX" value="SPI_SLAVE4"/> <!-- PB12 (inav) -->
    <define name="USE_MATEK_TYPE_OSD_CHIP" value="false" />
    <define name="USE_PAL_FOR_OSD_VIDEO" value="false" />
    <define name="BARO_ALTITUDE_VAR" value="baro_alt" /> <!-- if non defined the default var is ''baro_alt'' -->
    <!-- CURRENT SENSOR -->
    <configure name="ADC_CURRENT_SENSOR" value="ADC_2"/> <!-- inav -->
  </makefile>
</module>
